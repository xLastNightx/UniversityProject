{% extends "base.html" %}
{% block content %}
<div class="container">
    <h2 class="mb-4"><i class="bi bi-plus-circle"></i> Новая запись на маникюр</h2>
    
    {% if error %}
    <div class="alert alert-danger">{{ error }}</div>
    {% endif %}
    
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-body">
                    <form method="post" action="/bookings/create" id="booking-form">
                        <div class="mb-3">
                            <label class="form-label">Дата записи</label>
                                <input type="date" name="date" id="date-selector" class="form-control" 
                                    value="{{ selected_date }}" required
                                    min="{{ today }}"
                                    hx-get="/bookings/time-slots"
                                    hx-target="#time-slots-container"
                                    hx-trigger="change">

                        </div>
                        
                        <div id="time-slots-container">
                            {% include "time_slots_partial.html" %}
                        </div>
                        
                        <div class="mt-3">
                            <button type="submit" class="btn btn-success w-100">
                                <i class="bi bi-check-circle"></i> Записаться
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <div class="card mt-3">
                <div class="card-header">
                    <i class="bi bi-info-circle"></i> Информация
                </div>
                <div class="card-body">
                    <p><strong>Рабочие часы:</strong> 9:00–17:00</p>
                    <p><strong>Длительность процедуры:</strong> 2 часа</p>
                    <p><strong>Доступные слоты:</strong></p>
                    <ul class="mb-0">
                        <li>09:00–11:00</li>
                        <li>11:00–13:00</li>
                        <li>13:00–15:00</li>
                        <li>15:00–17:00</li>
                    </ul>
                    <p class="mt-2 mb-0"><small class="text-muted">Занятые слоты отмечены красным и недоступны для выбора</small></p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="mt-3 text-center">
        <a href="/bookings/" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Назад к записям
        </a>
    </div>
</div>

<script>
// JavaScript для установки сегодняшней даты
document.addEventListener('DOMContentLoaded', function() {
    const dateInput = document.getElementById('date-selector');
    
    // Если поле пустое, установим сегодняшнюю дату
    if (!dateInput.value) {
        const today = new Date();
        const yyyy = today.getFullYear();
        const mm = String(today.getMonth() + 1).padStart(2, '0');
        const dd = String(today.getDate()).padStart(2, '0');
        dateInput.value = `${yyyy}-${mm}-${dd}`;
    }
});
</script>

<!-- HTMX для динамических обновлений -->
<script src="https://unpkg.com/htmx.org@1.9.10"></script>
{% endblock %}